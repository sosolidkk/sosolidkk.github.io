<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Gnome/Keyring does not wraps around SSH Agent automatically</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Gnome/Keyring does not wraps around SSH Agent automatically" />
<meta name="author" content="João Pedro" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="It seems that starting from version 1:46.0-1, the gnome-keyring changed it’s behavior and now it disables building the ssh-agent support by default. The OS by default also doesn’t enable it, which was the cause for all my ssh-agents goes missing every time I tried to do any connection and even asking for password again. Lookint at the Gitlab MR, it seems like we’re now supposed to use gcr-ssh-agent. Here’s the instructions: Run: systemctl enable --user gcr-ssh-agent.socket to enable the socket. Set: $SSH_AUTH_SOCK environment value to $XDG_RUNTIME_DIR/gcr/ssh. I just put this in my .zshrc: export SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/gcr/ssh Reboot After those two changes, your SSH keys should start working just like before. Other workaround I was doing before finding those threads were adding this to my .zshrc: if [ -z &quot;$SSH_AUTH_SOCK&quot; ]; then eval &quot;$(ssh-agent -s)&quot; &gt; /dev/null ssh-add ~/.ssh/id_ed25519_github &amp;&gt; /dev/null ssh-add ~/.ssh/id_ed25519_gitlab &amp;&gt; /dev/null fi The problem with this approach is that it will init a new ssh-agent for every newly created console session since the .zshrc will be loaded every time. But since it was a workaround, I didn’t care. It was more stressful not to have it working at all. References Reddit gitlab/gnome-keyring #60 Wiki/Arch Linux - Keyring#SSH_keys https://bbs.archlinux.org/viewtopic.php?pid=2152021#p2152021" />
<meta property="og:description" content="It seems that starting from version 1:46.0-1, the gnome-keyring changed it’s behavior and now it disables building the ssh-agent support by default. The OS by default also doesn’t enable it, which was the cause for all my ssh-agents goes missing every time I tried to do any connection and even asking for password again. Lookint at the Gitlab MR, it seems like we’re now supposed to use gcr-ssh-agent. Here’s the instructions: Run: systemctl enable --user gcr-ssh-agent.socket to enable the socket. Set: $SSH_AUTH_SOCK environment value to $XDG_RUNTIME_DIR/gcr/ssh. I just put this in my .zshrc: export SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/gcr/ssh Reboot After those two changes, your SSH keys should start working just like before. Other workaround I was doing before finding those threads were adding this to my .zshrc: if [ -z &quot;$SSH_AUTH_SOCK&quot; ]; then eval &quot;$(ssh-agent -s)&quot; &gt; /dev/null ssh-add ~/.ssh/id_ed25519_github &amp;&gt; /dev/null ssh-add ~/.ssh/id_ed25519_gitlab &amp;&gt; /dev/null fi The problem with this approach is that it will init a new ssh-agent for every newly created console session since the .zshrc will be loaded every time. But since it was a workaround, I didn’t care. It was more stressful not to have it working at all. References Reddit gitlab/gnome-keyring #60 Wiki/Arch Linux - Keyring#SSH_keys https://bbs.archlinux.org/viewtopic.php?pid=2152021#p2152021" />
<link rel="canonical" href="https://sosolidkk.github.io//2024/07/07/gnome-keyring.html" />
<meta property="og:url" content="https://sosolidkk.github.io//2024/07/07/gnome-keyring.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-07T20:14:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Gnome/Keyring does not wraps around SSH Agent automatically" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"João Pedro"},"dateModified":"2024-07-07T20:14:00+00:00","datePublished":"2024-07-07T20:14:00+00:00","description":"It seems that starting from version 1:46.0-1, the gnome-keyring changed it’s behavior and now it disables building the ssh-agent support by default. The OS by default also doesn’t enable it, which was the cause for all my ssh-agents goes missing every time I tried to do any connection and even asking for password again. Lookint at the Gitlab MR, it seems like we’re now supposed to use gcr-ssh-agent. Here’s the instructions: Run: systemctl enable --user gcr-ssh-agent.socket to enable the socket. Set: $SSH_AUTH_SOCK environment value to $XDG_RUNTIME_DIR/gcr/ssh. I just put this in my .zshrc: export SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/gcr/ssh Reboot After those two changes, your SSH keys should start working just like before. Other workaround I was doing before finding those threads were adding this to my .zshrc: if [ -z &quot;$SSH_AUTH_SOCK&quot; ]; then eval &quot;$(ssh-agent -s)&quot; &gt; /dev/null ssh-add ~/.ssh/id_ed25519_github &amp;&gt; /dev/null ssh-add ~/.ssh/id_ed25519_gitlab &amp;&gt; /dev/null fi The problem with this approach is that it will init a new ssh-agent for every newly created console session since the .zshrc will be loaded every time. But since it was a workaround, I didn’t care. It was more stressful not to have it working at all. References Reddit gitlab/gnome-keyring #60 Wiki/Arch Linux - Keyring#SSH_keys https://bbs.archlinux.org/viewtopic.php?pid=2152021#p2152021","headline":"Gnome/Keyring does not wraps around SSH Agent automatically","mainEntityOfPage":{"@type":"WebPage","@id":"https://sosolidkk.github.io//2024/07/07/gnome-keyring.html"},"url":"https://sosolidkk.github.io//2024/07/07/gnome-keyring.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://sosolidkk.github.io//feed.xml" title="&lt;brain_dump/&gt;" />







<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Gnome/Keyring does not wraps around SSH Agent automatically</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Gnome/Keyring does not wraps around SSH Agent automatically" />
<meta name="author" content="João Pedro" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="It seems that starting from version 1:46.0-1, the gnome-keyring changed it’s behavior and now it disables building the ssh-agent support by default. The OS by default also doesn’t enable it, which was the cause for all my ssh-agents goes missing every time I tried to do any connection and even asking for password again. Lookint at the Gitlab MR, it seems like we’re now supposed to use gcr-ssh-agent. Here’s the instructions: Run: systemctl enable --user gcr-ssh-agent.socket to enable the socket. Set: $SSH_AUTH_SOCK environment value to $XDG_RUNTIME_DIR/gcr/ssh. I just put this in my .zshrc: export SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/gcr/ssh Reboot After those two changes, your SSH keys should start working just like before. Other workaround I was doing before finding those threads were adding this to my .zshrc: if [ -z &quot;$SSH_AUTH_SOCK&quot; ]; then eval &quot;$(ssh-agent -s)&quot; &gt; /dev/null ssh-add ~/.ssh/id_ed25519_github &amp;&gt; /dev/null ssh-add ~/.ssh/id_ed25519_gitlab &amp;&gt; /dev/null fi The problem with this approach is that it will init a new ssh-agent for every newly created console session since the .zshrc will be loaded every time. But since it was a workaround, I didn’t care. It was more stressful not to have it working at all. References Reddit gitlab/gnome-keyring #60 Wiki/Arch Linux - Keyring#SSH_keys https://bbs.archlinux.org/viewtopic.php?pid=2152021#p2152021" />
<meta property="og:description" content="It seems that starting from version 1:46.0-1, the gnome-keyring changed it’s behavior and now it disables building the ssh-agent support by default. The OS by default also doesn’t enable it, which was the cause for all my ssh-agents goes missing every time I tried to do any connection and even asking for password again. Lookint at the Gitlab MR, it seems like we’re now supposed to use gcr-ssh-agent. Here’s the instructions: Run: systemctl enable --user gcr-ssh-agent.socket to enable the socket. Set: $SSH_AUTH_SOCK environment value to $XDG_RUNTIME_DIR/gcr/ssh. I just put this in my .zshrc: export SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/gcr/ssh Reboot After those two changes, your SSH keys should start working just like before. Other workaround I was doing before finding those threads were adding this to my .zshrc: if [ -z &quot;$SSH_AUTH_SOCK&quot; ]; then eval &quot;$(ssh-agent -s)&quot; &gt; /dev/null ssh-add ~/.ssh/id_ed25519_github &amp;&gt; /dev/null ssh-add ~/.ssh/id_ed25519_gitlab &amp;&gt; /dev/null fi The problem with this approach is that it will init a new ssh-agent for every newly created console session since the .zshrc will be loaded every time. But since it was a workaround, I didn’t care. It was more stressful not to have it working at all. References Reddit gitlab/gnome-keyring #60 Wiki/Arch Linux - Keyring#SSH_keys https://bbs.archlinux.org/viewtopic.php?pid=2152021#p2152021" />
<link rel="canonical" href="https://sosolidkk.github.io//2024/07/07/gnome-keyring.html" />
<meta property="og:url" content="https://sosolidkk.github.io//2024/07/07/gnome-keyring.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-07T20:14:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Gnome/Keyring does not wraps around SSH Agent automatically" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"João Pedro"},"dateModified":"2024-07-07T20:14:00+00:00","datePublished":"2024-07-07T20:14:00+00:00","description":"It seems that starting from version 1:46.0-1, the gnome-keyring changed it’s behavior and now it disables building the ssh-agent support by default. The OS by default also doesn’t enable it, which was the cause for all my ssh-agents goes missing every time I tried to do any connection and even asking for password again. Lookint at the Gitlab MR, it seems like we’re now supposed to use gcr-ssh-agent. Here’s the instructions: Run: systemctl enable --user gcr-ssh-agent.socket to enable the socket. Set: $SSH_AUTH_SOCK environment value to $XDG_RUNTIME_DIR/gcr/ssh. I just put this in my .zshrc: export SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/gcr/ssh Reboot After those two changes, your SSH keys should start working just like before. Other workaround I was doing before finding those threads were adding this to my .zshrc: if [ -z &quot;$SSH_AUTH_SOCK&quot; ]; then eval &quot;$(ssh-agent -s)&quot; &gt; /dev/null ssh-add ~/.ssh/id_ed25519_github &amp;&gt; /dev/null ssh-add ~/.ssh/id_ed25519_gitlab &amp;&gt; /dev/null fi The problem with this approach is that it will init a new ssh-agent for every newly created console session since the .zshrc will be loaded every time. But since it was a workaround, I didn’t care. It was more stressful not to have it working at all. References Reddit gitlab/gnome-keyring #60 Wiki/Arch Linux - Keyring#SSH_keys https://bbs.archlinux.org/viewtopic.php?pid=2152021#p2152021","headline":"Gnome/Keyring does not wraps around SSH Agent automatically","mainEntityOfPage":{"@type":"WebPage","@id":"https://sosolidkk.github.io//2024/07/07/gnome-keyring.html"},"url":"https://sosolidkk.github.io//2024/07/07/gnome-keyring.html"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">&lt;brain_dump/&gt;</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/now/">Now</a><a class="page-link" href="/work/">Work</a><a class="page-link" href="/contact/">Contact</a><a class="page-link" href="/tags/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Gnome/Keyring does not wraps around SSH Agent automatically</h1>
    <span class="post-tags">
      Tags: [&nbsp;
      
        
        <a class="no-underline" href="/tag/linux">
          <code class="highligher-rouge">
            <nobr>linux</nobr>
          </code>
        </a>&nbsp;
       ]
    </span>
    <p class="post-meta"><time class="dt-published" datetime="2024-07-07T20:14:00+00:00" itemprop="datePublished">
        Jul 7, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>It seems that starting from version <strong>1:46.0-1</strong>, the <code class="language-plaintext highlighter-rouge">gnome-keyring</code> changed it’s behavior and now it disables building the <code class="language-plaintext highlighter-rouge">ssh-agent</code> support by default.</p>

<p>The OS by default also doesn’t enable it, which was the cause for all my <code class="language-plaintext highlighter-rouge">ssh-agents</code> goes missing every time I tried to do any connection and even asking for password again.</p>

<p>Lookint at the Gitlab MR, it seems like we’re now supposed to use <code class="language-plaintext highlighter-rouge">gcr-ssh-agent</code>. Here’s the instructions:</p>

<ol>
  <li><strong>Run</strong>: <code class="language-plaintext highlighter-rouge">systemctl enable --user gcr-ssh-agent.socket</code> to enable the socket.</li>
  <li><strong>Set</strong>: <code class="language-plaintext highlighter-rouge">$SSH_AUTH_SOCK</code> environment value to <code class="language-plaintext highlighter-rouge">$XDG_RUNTIME_DIR/gcr/ssh</code>. I just put this in my <code class="language-plaintext highlighter-rouge">.zshrc</code>:
    <ol>
      <li><code class="language-plaintext highlighter-rouge">export SSH_AUTH_SOCK=$XDG_RUNTIME_DIR/gcr/ssh</code></li>
    </ol>
  </li>
  <li><strong>Reboot</strong></li>
</ol>

<p>After those two changes, your SSH keys should start working just like before.</p>

<hr />

<p>Other workaround I was doing before finding those threads were adding this to my <code class="language-plaintext highlighter-rouge">.zshrc</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$SSH_AUTH_SOCK</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">eval</span> <span class="s2">"</span><span class="si">$(</span>ssh-agent <span class="nt">-s</span><span class="si">)</span><span class="s2">"</span> <span class="o">&gt;</span> /dev/null
  ssh-add ~/.ssh/id_ed25519_github &amp;&gt; /dev/null
  ssh-add ~/.ssh/id_ed25519_gitlab &amp;&gt; /dev/null
<span class="k">fi</span>
</code></pre></div></div>

<p>The problem with this approach is that it will init a new ssh-agent for every newly created console session since the <code class="language-plaintext highlighter-rouge">.zshrc</code> will be loaded every time. But since it was a workaround, I didn’t care. It was more stressful not to have it working at all.</p>

<h3 id="references">References</h3>
<ul>
  <li><a href="https://www.reddit.com/r/archlinux/comments/1aq97m8/gnomekeyring_14601_in_extratesting_disables/">Reddit</a></li>
  <li><a href="https://gitlab.gnome.org/GNOME/gnome-keyring/-/merge_requests/60">gitlab/gnome-keyring #60</a></li>
  <li><a href="https://wiki.archlinux.org/title/GNOME/Keyring#SSH_keys">Wiki/Arch Linux - Keyring#SSH_keys</a></li>
  <li><a href="https://bbs.archlinux.org/viewtopic.php?pid=2152021#p2152021">https://bbs.archlinux.org/viewtopic.php?pid=2152021#p2152021</a></li>
</ul>

  </div><a class="u-url" href="/2024/07/07/gnome-keyring.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://sosolidkk.github.io//feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">João Pedro</li>
          <li><a class="u-email" href="mailto:pedrochaveslimas3@gmail.com">pedrochaveslimas3@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Don&#39;t take everything you read here too seriously. Enjoy your stay!</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/sosolidkk" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://instagram.com/jpechaves" target="_blank" title="instagram">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#instagram"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://t.me/sosolidkk" target="_blank" title="telegram">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#telegram"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
<script>
    let elements = document.querySelectorAll('p');

    Array.prototype.forEach.call(elements, function(el, i){
        if(el.innerHTML.includes('[expand]')) {
            let parentcontent = el.parentNode.innerHTML.replace('<p>[expand]','<div class="expand" style="display: none; height: 0; overflow: hidden;">').replace('[/expand]</p>','</div>');
            el.parentNode.innerHTML = parentcontent;
        }
    });

    let newElements = document.querySelectorAll('div.expand');
    Array.prototype.forEach.call(newElements, function(el, i){
        newNode = document.createElement('div');
        newNode.innerHTML = '<a href="#" style="cursor: pointer;" onclick="this.parentNode.previousElementSibling.style.display = \'block\'; this.parentNode.previousElementSibling.style.height = \'auto\'; this.parentNode.style.display = \'none\';">Click to expand &rarr;</a>'
        el.parentNode.insertBefore(newNode, el.nextElementSibling);
    });
</script>
</body>
</html>
